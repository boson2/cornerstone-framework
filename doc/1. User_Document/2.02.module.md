<!--
{
	"id": 3,
	"title": "모듈화",
	"outline": "Single-page Web App은 하나의 페이지로 이루어진 웹 애플리케이션을 말한다. 페이지가 하나이므로 다른 페이지로 이동하거나 페이지 전체를 갱신하는 일 없이, 높은 사용성과 빠른 속도를 제공한다. 하지만, 하나의 페이지에 과도하게 많은 기능이 들어가면 페이지의 초기 로딩 시간이 길어지고 많은 메모리를 사용하게 되므로 적절하게 여러 페이지로 나누어 주는 것도 중요하다...",
	"tags": ["application"],
	"order": [2, 2],
	"thumbnail": "2.1.02.module.png"
}
-->

Single-page Web App
-------------------
Single-page Web App은 하나의 페이지로 이루어진 웹 애플리케이션을 말한다. 페이지가 하나이므로 다른 페이지로 이동하거나 페이지 전체를 갱신하는 일 없이, 높은 사용성과 빠른 속도를 제공한다.

하지만, 하나의 페이지에 과도하게 많은 기능이 들어가면 페이지의 초기 로딩 시간이 길어지고 많은 메모리를 사용하게 되므로 적절하게 여러 페이지로 나누어 주는 것도 중요하다. 여러 개의 페이지로 구성할 경우 페이지가 전환될 때 메모리가 초기화되고 html, css, js들을 다시 로드해야 하므로 연관성이 깊은 기능들끼리 같은 페이지로 묶는 것이 중요하다.

자바스크립트 모듈화
---------------
애플리케이션이 많은 기능을 가질 수록 자바스크립트의 양이 많아지고 복잡해지는 것은 필연적이다. 자바스크립트를 역할과 용도에 따라 분할해서 관리해야 재사용성과 유지보수성이 높아지는 것은 당연하다. 이렇게 분할된 여러 개의 js 파일을 script 태그를 사용해서 일일이 로드하는 것도 한 방법이나 다음과 같은 문제점을 가지게 된다.

- 개발자가 사용하고자 하는 js 파일을 a.js라고 하고, a.js가 내부적으로 b.js를 사용하고 있다고 하면, 개발자는 a.js 만을 필요로 하더라도 b.js도 로드해야 한다. 개발자가 사용하고자 하는 js 파일간의 의존성을 모두 파악하고 있어야 한다.
- b.js를 먼저 로드하고, a.js를 로드해야 한다. script 태그를 작성하는 순서를 항상 고려해야 한다.
- 기본적으로 브라우저는 스크립트를 동기적으로 로드하기 때문에(하나씩 순서대로) js 파일이 많아지는 경우 필요 이상의 시간이 소요되며, 그 문제를 해결하기 위해 async 속성을 선택적으로 부여하는 것은 막노동에 가까운 일이 된다.

이 문제를 해결하기 위해 Cornerstone Framework는 require.js를 사용하여 자바스크립트 모듈화를 지원한다. require.js에 대해 자세히 알고 싶다면 http://requirejs.org 를 방문하기 바란다.

require.js를 사용하면 하나의 js 파일을 하나의 모듈로서 정의할 수 있고, 모듈간의 의존성을 명시할 수 있다. 개발자는 필요한 모듈 하나만 선택해서 사용하면 된다. require.js가 선택된 모듈과 의존성을 가지는 모듈을 모두 알아서 순서에 맞게 로드하고 가능한 한 병렬적으로 로드하기 때문에 시간이 필요 이상으로 소요되는 문제도 해결된다.

하나의 파일에서는 하나의 모듈만 정의할 수 있으며, 다음과 같이 define 함수로 모듈을 정의할 수 있다.

```
// model/user.js 파일에서 정의한 모듈
define( {
	name: '홍길동',
	age: 40,
	gender: '남'
} );
```

정의된 모듈을 사용하는 쪽에서는 require 함수를 사용한다.

```
require( [ 'model/user' ], function( user ) {
	// 40이 콘솔로 출력된다.
	console.log( user.age );
} );
```

require 함수의 첫번째 파라미터는 필요한 모듈명의 배열이다. 모듈명은 js 파일의 상대 경로명에서 확장자를 제외한 것이다. 두번째 파라미터는 필요한 모듈이 모두 다 로드되고 나면 실행되는 함수인데, 함수의 파라미터로 로드된 모듈들이 넘겨진다.

모듈을 정의할 때 모듈이 정적인 object가 아니라 매번 새로운 객체를 사용해야 한다면, define 함수를 사용할 때 object 대신 function을 사용한다.

```
define( function() {

	// 나이를 매번 계산
	var age = …;
	
	return {
		name: '홍길동',
		age: age,
		gender: '남'
	};
} );
```

정의하고자 하는 모듈이 다른 모듈을 사용해야 한다면, require 함수를 사용할 때와 같은 방식으로 사용 가능하다.

```
define( [ 'model/calculator' ], function( calculator ) {

	// 나이를 매번 계산
	var age = calculator.calculateAge();
	
	return {
		name: '홍길동',
		age: age,
		gender: '남'
	};
} );
```

모든 js 파일들은 모듈로 정의되는 것이 좋다.
